# 合约部署步骤：
## 1.npm install --save-dev hardhat@^2.22.0 hardhat-deploy @openzeppelin/hardhat-upgrades @openzeppelin/contracts @openzeppelin/contracts-upgradeable  dotenv

## 2.npx hardhat test


# Hardhat 中 ethers.getContract / ethers.getContractAt / deployments.get 区别详解

## 🧩 一览表（对比总结）

| 方法 | 提供来源 | 是否依赖 `hardhat-deploy` | 是否自动读取部署记录 | 返回类型 | 典型使用场景 |
|------|-----------|----------------------------|------------------------|------------|----------------|
| **`ethers.getContract()`** | `hardhat-deploy` 注入的增强版 ethers | ✅ 是 | ✅ 是（从 `/deployments` 读取地址+ABI） | `ethers.Contract` 实例（已连接 signer） | 读取或操作 *已通过 hardhat-deploy 部署* 的合约 |
| **`ethers.getContractAt()`** | 原生 ethers.js 提供 | ❌ 否 | ❌ 否（你必须手动提供地址+ABI） | `ethers.Contract` 实例 | 连接任意地址（未必是自己部署的）上的合约 |
| **`deployments.get()`** | `hardhat-deploy` 提供 | ✅ 是 | ✅ 是 | **部署信息对象**（包含 address、ABI、部署交易等） | 获取部署元数据（不是直接可调用的合约实例） |

---

## 🔍 逐个详细讲解

### 1️⃣ `await ethers.getContract("ContractName", signer)`

> ✅ **hardhat-deploy 扩展提供的方法**

#### 🧠 功能
- 自动从 `deployments/` 目录中读取合约部署记录（`deployments/<network>/<ContractName>.json`）。
- 自动加载 ABI、地址。
- 自动返回一个 **`ethers.Contract` 实例**，并已连接 `signer`（默认是 `deployer`）。

#### 💡 用法示例
```js
const token = await ethers.getContract("MeteNode");
const stake = await ethers.getContract("MetaNodeStake", otherAccount);
```

#### 📦 典型用途
- 从 hardhat-deploy 的记录中快速读取合约实例。
- 不需要记地址或 ABI。

#### ⚠️ 注意
- 必须先用 hardhat-deploy 部署过。
- 仅在安装 `hardhat-deploy` 的项目中可用。

---

### 2️⃣ `await ethers.getContractAt("ABIorName", address, signer)`

> 💪 **原生 ethers.js 方法**

#### 🧠 功能
- 连接一个已存在的合约地址。
- 需要自己提供 ABI（或合约名）和合约地址。

#### 💡 用法示例
```js
const token = await ethers.getContractAt("MeteNode", "0x1234...abcd", signer);
```

#### 📦 典型用途
- 连接外部合约（如 Uniswap、USDT 等）。
- 连接任意地址上的合约。

#### ⚠️ 注意
- 不会自动去 `deployments` 文件夹找地址。
- 不返回部署信息，只返回 ethers 合约对象。

---

### 3️⃣ `await deployments.get("ContractName")`

> 📁 **hardhat-deploy 提供**

#### 🧠 功能
- 从 `deployments/<network>/<ContractName>.json` 读取部署信息。
- 返回普通对象，而非合约实例。

#### 💡 返回结构
```js
{
  address: "0x1234...abcd",
  abi: [...],
  receipt: {...},
  transactionHash: "...",
  args: [...]
}
```

#### 💡 用法示例
```js
const info = await deployments.get("MeteNode");
console.log(info.address);
const token = await ethers.getContractAt(info.abi, info.address);
```

#### 📦 典型用途
- 查看部署元数据、构造参数等。

---

## 🧭 使用建议

| 场景 | 推荐方法 | 原因 |
|------|------------|-------|
| 使用 hardhat-deploy 部署的合约 | `ethers.getContract(name)` | 自动找地址+signer |
| 只想获取部署信息 | `deployments.get(name)` | 获取元数据 |
| 连接外部合约 | `ethers.getContractAt(abi, address)` | 手动连接 |
| 自定义 signer | 两者皆可 | 灵活使用 |

---

## 📘 示例

```js
const token1 = await ethers.getContract("MeteNode");
const info = await deployments.get("MeteNode");
const token2 = await ethers.getContractAt("MeteNode", info.address);
```

---

## ⚙️ 一句话总结

- 🧩 **`ethers.getContract`**：依赖 hardhat-deploy，自动加载部署信息。
- 🧱 **`ethers.getContractAt`**：原生 ethers，用于任意地址。
- 📄 **`deployments.get`**：读取部署信息对象，用于查看或调试。



# Hardhat 中 deployed()/ waitForDeployment()  区别详解

| 方法 | 用途 | 适用合约类型 | 等待范围 | 备注 |
|------|------|-------------|---------|------|
| `deployed()` | 等待合约交易完成 | 普通合约 & Proxy | 仅交易确认 | v5/v6 都有；Proxy 也可用，但语义不够明确 |
| `waitForDeployment()` | 等待部署完成并初始化 | Proxy / Upgrades | Proxy + Implementation + initialize() | Ethers v6 新增；升级合约推荐用 |
