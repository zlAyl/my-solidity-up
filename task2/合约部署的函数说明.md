# åˆçº¦éƒ¨ç½²æ­¥éª¤ï¼š
## 1.npm install --save-dev hardhat@^2.22.0 hardhat-deploy @openzeppelin/hardhat-upgrades @openzeppelin/contracts @openzeppelin/contracts-upgradeable  dotenv

## 2.npx hardhat test


# Hardhat ä¸­ ethers.getContract / ethers.getContractAt / deployments.get åŒºåˆ«è¯¦è§£

## ğŸ§© ä¸€è§ˆè¡¨ï¼ˆå¯¹æ¯”æ€»ç»“ï¼‰

| æ–¹æ³• | æä¾›æ¥æº | æ˜¯å¦ä¾èµ– `hardhat-deploy` | æ˜¯å¦è‡ªåŠ¨è¯»å–éƒ¨ç½²è®°å½• | è¿”å›ç±»å‹ | å…¸å‹ä½¿ç”¨åœºæ™¯ |
|------|-----------|----------------------------|------------------------|------------|----------------|
| **`ethers.getContract()`** | `hardhat-deploy` æ³¨å…¥çš„å¢å¼ºç‰ˆ ethers | âœ… æ˜¯ | âœ… æ˜¯ï¼ˆä» `/deployments` è¯»å–åœ°å€+ABIï¼‰ | `ethers.Contract` å®ä¾‹ï¼ˆå·²è¿æ¥ signerï¼‰ | è¯»å–æˆ–æ“ä½œ *å·²é€šè¿‡ hardhat-deploy éƒ¨ç½²* çš„åˆçº¦ |
| **`ethers.getContractAt()`** | åŸç”Ÿ ethers.js æä¾› | âŒ å¦ | âŒ å¦ï¼ˆä½ å¿…é¡»æ‰‹åŠ¨æä¾›åœ°å€+ABIï¼‰ | `ethers.Contract` å®ä¾‹ | è¿æ¥ä»»æ„åœ°å€ï¼ˆæœªå¿…æ˜¯è‡ªå·±éƒ¨ç½²çš„ï¼‰ä¸Šçš„åˆçº¦ |
| **`deployments.get()`** | `hardhat-deploy` æä¾› | âœ… æ˜¯ | âœ… æ˜¯ | **éƒ¨ç½²ä¿¡æ¯å¯¹è±¡**ï¼ˆåŒ…å« addressã€ABIã€éƒ¨ç½²äº¤æ˜“ç­‰ï¼‰ | è·å–éƒ¨ç½²å…ƒæ•°æ®ï¼ˆä¸æ˜¯ç›´æ¥å¯è°ƒç”¨çš„åˆçº¦å®ä¾‹ï¼‰ |

---

## ğŸ” é€ä¸ªè¯¦ç»†è®²è§£

### 1ï¸âƒ£ `await ethers.getContract("ContractName", signer)`

> âœ… **hardhat-deploy æ‰©å±•æä¾›çš„æ–¹æ³•**

#### ğŸ§  åŠŸèƒ½
- è‡ªåŠ¨ä» `deployments/` ç›®å½•ä¸­è¯»å–åˆçº¦éƒ¨ç½²è®°å½•ï¼ˆ`deployments/<network>/<ContractName>.json`ï¼‰ã€‚
- è‡ªåŠ¨åŠ è½½ ABIã€åœ°å€ã€‚
- è‡ªåŠ¨è¿”å›ä¸€ä¸ª **`ethers.Contract` å®ä¾‹**ï¼Œå¹¶å·²è¿æ¥ `signer`ï¼ˆé»˜è®¤æ˜¯ `deployer`ï¼‰ã€‚

#### ğŸ’¡ ç”¨æ³•ç¤ºä¾‹
```js
const token = await ethers.getContract("MeteNode");
const stake = await ethers.getContract("MetaNodeStake", otherAccount);
```

#### ğŸ“¦ å…¸å‹ç”¨é€”
- ä» hardhat-deploy çš„è®°å½•ä¸­å¿«é€Ÿè¯»å–åˆçº¦å®ä¾‹ã€‚
- ä¸éœ€è¦è®°åœ°å€æˆ– ABIã€‚

#### âš ï¸ æ³¨æ„
- å¿…é¡»å…ˆç”¨ hardhat-deploy éƒ¨ç½²è¿‡ã€‚
- ä»…åœ¨å®‰è£… `hardhat-deploy` çš„é¡¹ç›®ä¸­å¯ç”¨ã€‚

---

### 2ï¸âƒ£ `await ethers.getContractAt("ABIorName", address, signer)`

> ğŸ’ª **åŸç”Ÿ ethers.js æ–¹æ³•**

#### ğŸ§  åŠŸèƒ½
- è¿æ¥ä¸€ä¸ªå·²å­˜åœ¨çš„åˆçº¦åœ°å€ã€‚
- éœ€è¦è‡ªå·±æä¾› ABIï¼ˆæˆ–åˆçº¦åï¼‰å’Œåˆçº¦åœ°å€ã€‚

#### ğŸ’¡ ç”¨æ³•ç¤ºä¾‹
```js
const token = await ethers.getContractAt("MeteNode", "0x1234...abcd", signer);
```

#### ğŸ“¦ å…¸å‹ç”¨é€”
- è¿æ¥å¤–éƒ¨åˆçº¦ï¼ˆå¦‚ Uniswapã€USDT ç­‰ï¼‰ã€‚
- è¿æ¥ä»»æ„åœ°å€ä¸Šçš„åˆçº¦ã€‚

#### âš ï¸ æ³¨æ„
- ä¸ä¼šè‡ªåŠ¨å» `deployments` æ–‡ä»¶å¤¹æ‰¾åœ°å€ã€‚
- ä¸è¿”å›éƒ¨ç½²ä¿¡æ¯ï¼Œåªè¿”å› ethers åˆçº¦å¯¹è±¡ã€‚

---

### 3ï¸âƒ£ `await deployments.get("ContractName")`

> ğŸ“ **hardhat-deploy æä¾›**

#### ğŸ§  åŠŸèƒ½
- ä» `deployments/<network>/<ContractName>.json` è¯»å–éƒ¨ç½²ä¿¡æ¯ã€‚
- è¿”å›æ™®é€šå¯¹è±¡ï¼Œè€Œéåˆçº¦å®ä¾‹ã€‚

#### ğŸ’¡ è¿”å›ç»“æ„
```js
{
  address: "0x1234...abcd",
  abi: [...],
  receipt: {...},
  transactionHash: "...",
  args: [...]
}
```

#### ğŸ’¡ ç”¨æ³•ç¤ºä¾‹
```js
const info = await deployments.get("MeteNode");
console.log(info.address);
const token = await ethers.getContractAt(info.abi, info.address);
```

#### ğŸ“¦ å…¸å‹ç”¨é€”
- æŸ¥çœ‹éƒ¨ç½²å…ƒæ•°æ®ã€æ„é€ å‚æ•°ç­‰ã€‚

---

## ğŸ§­ ä½¿ç”¨å»ºè®®

| åœºæ™¯ | æ¨èæ–¹æ³• | åŸå›  |
|------|------------|-------|
| ä½¿ç”¨ hardhat-deploy éƒ¨ç½²çš„åˆçº¦ | `ethers.getContract(name)` | è‡ªåŠ¨æ‰¾åœ°å€+signer |
| åªæƒ³è·å–éƒ¨ç½²ä¿¡æ¯ | `deployments.get(name)` | è·å–å…ƒæ•°æ® |
| è¿æ¥å¤–éƒ¨åˆçº¦ | `ethers.getContractAt(abi, address)` | æ‰‹åŠ¨è¿æ¥ |
| è‡ªå®šä¹‰ signer | ä¸¤è€…çš†å¯ | çµæ´»ä½¿ç”¨ |

---

## ğŸ“˜ ç¤ºä¾‹

```js
const token1 = await ethers.getContract("MeteNode");
const info = await deployments.get("MeteNode");
const token2 = await ethers.getContractAt("MeteNode", info.address);
```

---

## âš™ï¸ ä¸€å¥è¯æ€»ç»“

- ğŸ§© **`ethers.getContract`**ï¼šä¾èµ– hardhat-deployï¼Œè‡ªåŠ¨åŠ è½½éƒ¨ç½²ä¿¡æ¯ã€‚
- ğŸ§± **`ethers.getContractAt`**ï¼šåŸç”Ÿ ethersï¼Œç”¨äºä»»æ„åœ°å€ã€‚
- ğŸ“„ **`deployments.get`**ï¼šè¯»å–éƒ¨ç½²ä¿¡æ¯å¯¹è±¡ï¼Œç”¨äºæŸ¥çœ‹æˆ–è°ƒè¯•ã€‚



# Hardhat ä¸­ deployed()/ waitForDeployment()  åŒºåˆ«è¯¦è§£

| æ–¹æ³• | ç”¨é€” | é€‚ç”¨åˆçº¦ç±»å‹ | ç­‰å¾…èŒƒå›´ | å¤‡æ³¨ |
|------|------|-------------|---------|------|
| `deployed()` | ç­‰å¾…åˆçº¦äº¤æ˜“å®Œæˆ | æ™®é€šåˆçº¦ & Proxy | ä»…äº¤æ˜“ç¡®è®¤ | v5/v6 éƒ½æœ‰ï¼›Proxy ä¹Ÿå¯ç”¨ï¼Œä½†è¯­ä¹‰ä¸å¤Ÿæ˜ç¡® |
| `waitForDeployment()` | ç­‰å¾…éƒ¨ç½²å®Œæˆå¹¶åˆå§‹åŒ– | Proxy / Upgrades | Proxy + Implementation + initialize() | Ethers v6 æ–°å¢ï¼›å‡çº§åˆçº¦æ¨èç”¨ |
